## Legend

- `packageName`: parent package name (e.g. `@nrwl/nx-source`)
- `package`: package name (e.g. `@nrwl/workspace`)
- `version`: exact package version (e.g. `1.2.34`)
- `versionRange`: package version based on requirement (e.g. `^13.3.0`)

## Potential issues

- How to handle hoisting in the monorepo packages?
- Peer dependencies?

## Yarn

Calling `my-package` resolves to the first instance of `my-package` in the lock file, in case of the hoisting

Parsed JSON

```
{
  '{package}@{versionRange}': {
    version: '{version}',
    {additionalFields}
    dependencies:
      {package}: {versionRange}
  }
}
```

Or for Berry

```
{
  __metadata: {
    version: '7',
    cacheKey: '9'
  },
  '{package}@{versionRange}': {
    version: '{version}',
    {additionalFields}
    dependencies:
    {package}: {versionRange}
  }
}
```

### Yarn Classic `yarn.lock`

Yarn classic does not track peer dependencies

```
# THIS IS AN AUTOGENERATED FILE. DO NOT EDIT THIS FILE DIRECTLY.
# yarn lockfile v1

"{package}@{versionRange}":
  version "{version}"
  {additionalFields}
  dependencies:
    "{package}" "{versionRange}"

"{package}@{versionRange}", "{package}@{versionRange}", "{package}@{versionRange}", ...:
  version "{version}"
  {additionalFields}
  dependencies:
    "{package}" "{versionRange}"

```

### Yarn Berry `yarn.lock`

```
# This file is generated by running "yarn install" inside your project.
# Manual changes might be lost - proceed with caution!

__metadata:
  version: 7
  cacheKey: 9

"{package}@npm:{versionRange}":
  version {version}
  {additionalFields}
  dependencies?:
    "{package}": "npm:{versionRange}"

"{package}@npm:{versionRange}, {package}@npm:{versionRange}, {package}@npm:{versionRange}, ...":
  version "{version}"
  {additionalFields}
  dependencies?:
    "{package}": "npm:{versionRange}"
  peerDependencies?:
    "{package}": {versionRange}
  peerDependenciesMeta?:
    "{package}":
      optional: true
```

## NPM package-lock.json

> We should map packages as it contains more information
> and use that to compile entire file from scratch

```
{
  "name": "{packageName}",
  "lockfileVersion": 2,
  "requires": true,
  "packages": {
    "": {
      "name": "{packageName}"
      "license": "MIT" // why is this important?
      "dependencies?": {
        "{package}": "{versionRange}"
      },
      "devDependencies?": {
        "{package}": "{versionRange}"
      }
    },
    "node_modules/{package}": {
      // same as dependencies
      // "requires" becomes "dependencies"
      "license": "MIT"
    },
    "node_modules/{package}/node_modules/{package}...": {
    }
  },
  "dependencies": {
    "{packageName}": {
      "version": "{version}",
      "dev"?: boolean;
      {additionalFields}
      "requires"?: {
        "{package}": "{versionRange}"
      },
      "dependencies"?: {
        "{packageName}": {
          // same as parent, must be one of "requires"
        }
      }
    },
  }
}
```

## PMPM pnpm-lock.yml

### Standard specifiers

```
lockfileVersion: 5.4

neverBuiltDependencies:
  - {package}
  - {package}

overrides:
  {packages}: {versionRange}

patchedDependencies:
  {package}@{version}:
    hash: pp6fkuhwkrqq7cjcj7uqpf37e4
    path: patches/{package}@{version}.patch

specifiers:
  {package}: {versionRange}
  '@something/{package}': {versionRange}

dependencies:
  {package}: {version}
  {package}: {version}_hashcode
  {package}: {version}_{package}@{version}

devDependencies:
  {package}: {version}
  {package}: {version}_hashcode
  {package}: {version}_{package}@{version}

packages:
  /{package}/{version}:
    ...
    dependencies?:
      {package}: {version/with hash/with package}
  /{package}/{version}_hashcode:
    ...
    dependencies?:
      {package}: {version/with hash/with package}
  /{package}/{version}_{package}@{version}:
    ...
    dependencies?:
      {package}: {version/with hash/with package}
    peerDependencies?:
      {package}: {versionRange} // this is already included in dependencies
    transitivePeerDependencies:
      - {package}
      - {package}
```

### Inlined specifiers

```
lockfileVersion: 5.4-inlineSpecifiers

neverBuiltDependencies:
  - {package}
  - {package}

overrides:
  {packages}: {versionRange}

patchedDependencies:
  {package}@{version}:
    hash: pp6fkuhwkrqq7cjcj7uqpf37e4
    path: patches/{package}@{version}.patch

dependencies:
  {package}:
    specifier: {versionRange}
    version: {version}
  {package}:
    specifier: {versionRange}
    version: {version}_hashcode
  {package}:
    specifier: {versionRange}
    version: {version}_{package}@{version}

devDependencies:
  {package}:
    specifier: {versionRange}
    version: {version}
  {package}:
    specifier: {versionRange}
    version: {version}_hashcode
  {package}:
    specifier: {versionRange}
    version: {version}_{package}@{version}

packages:
  /{package}/{version}:
    ...
    dependencies?:
      {package}: {version/with hash/with package}
  /{package}/{version}_hashcode:
    ...
    dependencies?:
      {package}: {version/with hash/with package}
  /{package}/{version}_{package}@{version}:
    ...
    dependencies?:
      {package}: {version/with hash/with package}
    peerDependencies?:
      {package}: {versionRange} // this is already included in dependencies
    transitivePeerDependencies:
      - {package}
      - {package}

```
