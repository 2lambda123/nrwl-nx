{
  "githubRoot": "https://github.com/nrwl/nx/blob/master",
  "name": "nx-plugin",
  "description": "Plugin for creating plugins for Nx :)",
  "root": "C:/development/nx/packages/nx-plugin",
  "source": "C:\\development\\nx\\packages\\nx-plugin\\src",
  "documentation": [
    {
      "id": "overview",
      "name": "Overview",
      "path": "/packages/nx-plugin",
      "file": "shared/nx-plugin",
      "content": "Nx plugins are npm packages that contain generators and executors to extend a Nx workspace. Generators are blueprints to create new files from templates, and executors run those files. These plugins also update the `nx.json` when generating new libs or apps.\r\n\r\n> A list of plugins that is maintained by Nrwl is found in the [Nrwl/nx repo](https://github.com/nrwl/nx/tree/master/packages). \\\r\n> A list of custom plugins created by the community is found in the [Community](/community) section.\r\n> Plugins are written using Nx Devkit. **Read [Nx Devkit](/devkit/index) for more information.**\r\n\r\n{% youtube\r\nsrc=\"https://www.youtube.com/embed/fC1-4fAZDP4\"\r\ntitle=\"Nx Tutorial: Building Custom Plugins for Nx\"\r\nwidth=\"100%\" /%}\r\n\r\n## Generating a Plugin\r\n\r\nTo get started with building a Nx Plugin, run the following command:\r\n\r\n```bash\r\nnpx create-nx-plugin my-org --pluginName my-plugin\r\n```\r\n\r\nThis command creates a brand-new workspace, and sets up a pre-configured plugin with the specified name.\r\n\r\n> Note, the command above will create a plugin the package name set to `@my-org/my-plugin`. You can pass `--importPath` to provide a different package name.\r\n\r\n> If you do not want to create a new workspace, install the `@nrwl/nx-plugin` dependency in an already existing workspace with npm or yarn. Then run `nx g @nrwl/nx-plugin:plugin [pluginName]`.\r\n\r\nA new plugin is created with a default generator, executor, and e2e app.\r\n\r\n## Generator\r\n\r\nThe created generator contains boilerplate that will do the following:\r\n\r\n- Normalize a schema (the options that the generator accepts)\r\n- Update the `workspace.json`\r\n- Add the plugin's project to the `nx.json` file\r\n- Add files to the disk using templates\r\n\r\nThere will be an exported default function that will be the main entry for the generator.\r\n\r\n### Generator options\r\n\r\nThe `schema.d.ts` file contains all the options that the generator supports. By default, it includes `directory`, `tags`, and `name` as the options. If more options need to be added, please update this file and the `schema.json` file.\r\n\r\n{% callout type=\"note\" title=\"More details\" %}\r\nThe `schema.d.ts` file is used for type checking inside the implementation file. It should match the properties in `schema.json`.\r\n{% /callout %}\r\n\r\n### Adding more generators\r\n\r\nTo add more generators to the plugin, run the following command:\r\n`nx generate @nrwl/nx-plugin:generator [generatorName] --project=[pluginName]`.\r\n\r\nThis will scaffold out a new generator and update the necessary files to support it.\r\n\r\n### Generator Testing\r\n\r\nThe generator spec file includes boilerplate to help get started with testing. This includes setting up an empty workspace.\r\n\r\nThese tests should ensure that files within the tree (created with `createTreeWithEmptyWorkspace`) are in the correct place, and contain the right content.\r\n\r\nFull E2Es are supported (and recommended) and will run everything on the file system like a user would.\r\n\r\n## Executor\r\n\r\nThe default executor is set up to just emit a console log. Some examples of what an executor can do are:\r\n\r\n- Support different languages, (Java, Go, Python, C#)\r\n- Compile new UI framework components\r\n- Deploy an app on a CDN\r\n- Publish to NPM\r\n- and many more!\r\n\r\n### Adding more executors\r\n\r\nTo add more executors to the plugin, run the following command:\r\n`nx generate @nrwl/nx-plugin:executor [executor] --project=[pluginName]`.\r\n\r\nThis will scaffold out a new generator and update the necessary files to support it.\r\n\r\n### Executor testing\r\n\r\nThe executor spec file contains boilerplate to run the default exported function from the executor.\r\n\r\nThese tests should make sure that the executor is executing and calling the functions that it relies on.\r\n\r\nFull E2Es are supported (and recommended) and will run everything on the file system like a user would.\r\n\r\n## Testing your plugin\r\n\r\nOne of the biggest benefits that the Nx Plugin package provides is support for E2E and unit testing.\r\n\r\nWhen the E2E app runs, a temporary E2E directory is created in the root of the workspace. This directory is a blank Nx workspace, and will have the plugin's built package installed locally.\r\n\r\n### E2E Testing file\r\n\r\nWhen the plugin is generated, a test file is created in the `my-plugin-e2e` app. Inside this test file, there are already tests for making sure that the executor ran, checking if directories are created with the `--directory` option, and checking if tags are added to the project configuration.\r\n\r\nWe'll go over a few parts of a test file below:\r\n\r\n```typescript\r\nit('should create my-plugin', async (done) => {\r\n  const plugin = uniq('my-plugin');\r\n  ensureNxProject('@my-org/my-plugin', 'dist/packages/my-plugin');\r\n  await runNxCommandAsync(`generate @my-org/my-plugin:myPlugin ${plugin}`);\r\n\r\n  const result = await runNxCommandAsync(`build ${plugin}`);\r\n  expect(result.stdout).toContain('Executor ran');\r\n\r\n  done();\r\n});\r\n```\r\n\r\n- The `uniq` function creates a random name with the prefix and a random number.\r\n- The `ensureNxProject` is the function that will create the temporary directory. It takes two arguments, the plugin package name and the dist directory of when it's built.\r\n- The `runNxCommandAsync` will execute a `nx` command in the E2E directory.\r\n\r\nThere are additional functions that the `@nrwl/nx-plugin/testing` package exports. Most of them are file utilities to manipulate and read files in the E2E directory.\r\n\r\n## Including Assets\r\n\r\nSometimes you might want to include some assets with the plugin. This might be a image or some additional binaries.\r\n\r\nTo make sure that assets are copied to the dist folder, open the plugin's `project.json` file. Inside the `build` property, add additional assets. By default, all `.md` files in the root, all non-ts files in folders, and the `generators.json` and `executors.json` files are included.\r\n\r\n```json\r\n\"build\": {\r\n  \"executor\": \"@nrwl/node:package\",\r\n  \"options\": {\r\n    // shortened...\r\n    \"assets\": [\r\n      \"packages/my-plugin/*.md\",\r\n      {\r\n        \"input\": \"./packages/my-plugin/src\",\r\n        \"glob\": \"**/*.!(ts)\",\r\n        \"output\": \"./src\"\r\n      },\r\n      {\r\n        \"input\": \"./packages/my-plugin\",\r\n        \"glob\": \"generators.json\",\r\n        \"output\": \".\"\r\n      },\r\n      {\r\n        \"input\": \"./packages/my-plugin\",\r\n        \"glob\": \"executors.json\",\r\n        \"output\": \".\"\r\n      }\r\n    ]\r\n  }\r\n}\r\n```\r\n\r\n## Using your Nx Plugin\r\n\r\nTo use your plugin, simply list it in `nx.json` or use its generators and executors as you would for any other plugin. This could look like `nx g @my-org/my-plugin:lib` for generators or `\"executor\": \"@my-org/my-plugin:build\"` for executors. It should be usable in all of the same ways as published plugins in your local workspace immediately after generating it. This includes setting it up as the default collection in `nx.json`, which would allow you to run `nx g lib` and hit your plugin's generator.\r\n\r\n## Publishing your Nx Plugin\r\n\r\nIn order to use your plugin in other workspaces or share it with the community, you will need to publish it to an npm registry. To publish your plugin follow these steps:\r\n\r\n1. Build your plugin with the command `nx run my-plugin:build`\r\n1. `npm publish ./dist/package/my-plugin` and follow the prompts from npm.\r\n1. That's it!\r\n\r\n{% callout type=\"warning\" title=\"Version bump\" %}\r\nCurrently you will have to modify the `package.json` version by yourself or with a tool.\r\n{% /callout %}\r\n\r\nAfter that, you can then install your plugin like any other npm package,\r\n`npm i -D @my-org/my-plugin` or `yarn add -D @my-org/my-plugin`.\r\n\r\n### Listing your Nx Plugin\r\n\r\nNx provides a utility (`nx list`) that lists both core and community plugins. To submit your plugin, please follow the steps below:\r\n\r\n- Fork the [Nx repo](https://github.com/nrwl/nx/fork) (if you haven't already)\r\n- Update the [`community/approved-plugins.json` file](https://github.com/nrwl/nx/blob/master/community/approved-plugins.json) with a new entry for your plugin that includes name, url and description\r\n- Use the following commit message template: `chore(core): nx plugin submission [PLUGIN_NAME]`\r\n- push your changes, and run `yarn submit-plugin`\r\n\r\n> The `yarn submit-plugin` command automatically opens the Github pull request process with the correct template.\r\n\r\nWe will then verify the plugin, offer suggestions or merge the pull request!\r\n\r\n## Preset\r\n\r\nA Preset is a customization option which you provide when creating a new workspace. TS, Node, React are some internal presets that Nx provides by default.\r\n\r\n{% youtube\r\nsrc=\"https://www.youtube.com/embed/yGUrF0-uqaU\"\r\ntitle=\"Develop a Nx Preset for your Nx Plugin\"\r\nwidth=\"100%\" /%}\r\n\r\n### Custom Preset\r\n\r\nAt its core a preset is a generator, which we can create inside of a plugin.\r\nIf you **don't** have an existing plugin you can create one by running\r\n\r\n```bash\r\n  npx create-nx-plugin my-org --pluginName my-plugin\r\n```\r\n\r\nTo create our preset inside of our plugin we can run\r\n\r\n```bash\r\n  nx generate @nrwl/nx-plugin:generator --name=preset --project=happynrwl\r\n```\r\n\r\n{% callout type=\"warning\" title=\"Double check\" %}\r\nThe word `preset` is required for the name of this generator\r\n{% /callout %}\r\n\r\nYou should have a similar structure to this:\r\n\r\n```treeview\r\nhappynrwl/\r\n\t├── e2e\r\n\t├── jest.config.js\r\n\t├── jest.preset.js\r\n\t├── nx.json\r\n\t├── package-lock.json\r\n\t├── package.json\r\n\t├── packages\r\n\t│   └── happynrwl\r\n\t│       ├── src\r\n\t│       │   ├── executors\r\n\t│       │   ├── generators\r\n\t│       │   │   ├── happynrwl\r\n\t│       │   │   └── preset \t\t// <------------- Here\r\n\t│       │   └── index.ts\r\n\t├── tools\r\n\t├── tsconfig.base.json\r\n\t└── workspace.json\r\n```\r\n\r\nAfter the command is finished, the preset generator is created under the folder named **preset**.\r\nThe **generator.ts** provides an entry point to the generator. This file contains a function that is called to perform manipulations on a tree that represents the file system. The **schema.json** provides a description of the generator, available options, validation information, and default values.\r\n\r\nHere is the sample generator function which you can customize to meet your needs.\r\n\r\n```typescript\r\nexport default async function (tree: Tree, options: PresetGeneratorSchema) {\r\n  const normalizedOptions = normalizeOptions(tree, options);\r\n  addProjectConfiguration(tree, normalizedOptions.projectName, {\r\n    root: normalizedOptions.projectRoot,\r\n    projectType: 'application',\r\n    sourceRoot: `${normalizedOptions.projectRoot}/src`,\r\n    targets: {\r\n      exec: {\r\n        executor: 'nx:run-commands',\r\n        options: {\r\n          command: `node ${projectRoot}/src/index.js`,\r\n        },\r\n      },\r\n    },\r\n    tags: normalizedOptions.parsedTags,\r\n  });\r\n  addFiles(tree, normalizedOptions);\r\n  await formatFiles(tree);\r\n}\r\n```\r\n\r\nTo get an in-depth guide on customizing/running or debugging your generator see [workspace generators](https://nx.dev/generators/workspace-generators#running-a-workspace-generator).\r\n\r\n#### Usage\r\n\r\nBefore you are able to use your newly created preset you must package and publish it to a registry.\r\n\r\nAfter you have published your plugin to a registry you can now use your preset when creating a new workspace\r\n\r\n```bash\r\nnpx create-nx-workspace my-workspace --preset=my-plugin-name\r\n```\r\n"
    }
  ],
  "generators": [],
  "executors": []
}
